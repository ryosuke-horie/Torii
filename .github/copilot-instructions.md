# Copilot instructions

以下ドキュメントをベースに開発を行います。
回答はこちらをベースに考えてください。

## 基本の開発フロー

### 1.  要件定義

- ChatGPT O1を利用しつつ機能ベースに要件定義を進めていく
- Notionに設計書として機能ベースで残していく

### 2. タスク分解

- 大枠となるタスク分解をNotionのDBに保存してまとめていく
  - 2週間単位のマイルストーンを敷いて対応範囲を検討する
- 2週間のマイルストーン内のタスクを詳細に分割し、GitHub Issueに登録する
  - CRUDのような操作機能単位をベースに分割
  - GitHub Issue内での実装順序
        1. 要件定義内容を元に単体テストを記述する（バックエンド）
        2. API・UIの実装を纏めて１件のIssueで対応
        3. フロントエンドで実装したコンポーネントのシナリオ作成
        4. シナリオからコンポーネントの単体テストを実装

### 3. デザイン

- タスク分解を行なって解像度をもった段階でデザインに入っていく
- OnLookを活用しデザインの手間を減らす
- 1機能単位でデザインを行う

### 4. 実装

- バックエンドAPIはTDDを単体テストで実践する
  - テストのためにもアーキテクチャはレイヤードアーキを意識しディレクトリ毎に責任を明確に分離したい
- 以下の順序に実装を進める
    1. 要件定義内容を元に単体テストを記述する（バックエンド）
    2. API・UIの実装を纏めて１件のIssueで対応
    3. フロントエンドで実装したコンポーネントのシナリオ作成
    4. シナリオからコンポーネントの単体テストを実装
- 機能単位の実装が済んだらE2Eテストを記述する
  - シナリオベースのテストを実装
- テストコードの方針
  - バックエンド
    - 単体テストで網羅
    - E2Eと単体テストのカバレッジにより、ある程度の担保ができると踏む
  - フロントエンド
    - UIに閉じてコンポーネント単位でテストコードを実装する
      - UI関連のライブラリの更新の工数を抑える意図
      - スナップショット的なテストの導入も検討
    - ページコンポーネントのテストはE2Eである程度網羅すると割り切る
  - E2E
    - 正常系のシナリオテストを記載する
    - 重要な機能・シナリオに変更が悪影響を与えないことを担保する

## 前提の考え方

- cloudflare workers + D1のインフラ構成の載せる前提で選定する
  - Edgeランタイムで動作すること
  - ライブラリは小さいサイズであることが条件に入る
- 生成AIを活用した開発がメインとなる
  - ライブラリ自体の知名度は担保する必要がある
  - 開発がストップしなさそうであること

## フロントエンド

### LP

- Next.jsを採用
- Cloudflare Pages+Functionで十分
- 静的サイトとして構築する

### ジム管理側・ユーザー側

- Nextjsを採用
- Cloudflare Workers上でSSRする

### テスト

- コンポーネントのVRT
  - Storybook + reg-suit + storycap
- シナリオE2E
  - Playwright

## バックエンド

- Honoを採用
- レイヤードアーキテクチャを採用
- Rest APIとして実装する
  - tRPCは肌感とAIベースの開発には合わないと考えているため
- DB(SQLite)操作にDrizzleを採用
- 認証にJWTを使用するため、Joseを採用

## 共通

- OpenNextでCloudflare Workers用の雛形でデプロイする
